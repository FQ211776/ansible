#!/usr/bin/env bash

# Detectar la distribución del sistema operativo
if [ -f /etc/os-release ]; then
    . /etc/os-release
    OS=$ID
else
    echo "No se pudo detectar la distribución del sistema operativo."
    exit 1
fi

# Función para instalar Ansible en Ubuntu
install_ansible_ubuntu() {
    sudo apt-add-repository -y ppa:ansible/ansible
    sudo apt-get update -y
    sudo apt-get install -y curl git software-properties-common ansible
}

# Función para instalar Ansible en Arch Linux
install_ansible_arch() {
    sudo pacman -Sy --noconfirm curl git base-devel
    sudo pacman -S --noconfirm ansible
}

# Verificar si Ansible está instalado y proceder con la instalación si no lo está
if ! command -v ansible &> /dev/null
then
    echo "Ansible no está instalado. Procediendo con la instalación..."
    case $OS in
        ubuntu)
            install_ansible_ubuntu
            ;;
        arch)
            install_ansible_arch
            ;;
        *)
            echo "Distribución no soportada: $OS"
            exit 1
            ;;
    esac
else
    echo "Ansible ya está instalado."
fi

## pull ansible
#!/bin/bash
# shellcheck disable=SC2164
# shellcheck disable=SC1090

function cleanup() {
  sudo apt-get -y autoremove
  [[ -d "$HOME/.dotbare" ]] && rm -rf ~/.dotbare
}

trap cleanup EXIT

# -- INIT ----------------------------------------------------------------------

export XDG_CONFIG_HOME="$HOME/.config"
export XDG_DATA_HOME="$HOME/.local/share"
export XDG_CACHE_HOME="$HOME/.cache"
export OS_DISTRO="UBUNTU"
export NONINTERACTIVE=1
export NVIM_HOME="${XDG_DATA_HOME}/nvim"
mkdir -p "$XDG_CACHE_HOME"/zsh
cd "$HOME"

# -- APT -----------------------------------------------------------------------

sudo apt-get -y update
sudo apt-get -y install build-essential
sudo apt-get -y install \
  python3-pip \
  git \
  zsh


# -- GIT -----------------------------------------------------------------------

git clone https://github.com/kazhala/dotbare.git ~/.dotbare

# -- DOTBARE -------------------------------------------------------------------

source ~/.dotbare/dotbare.plugin.bash
dotbare finit -u https://github.com/FQ211776/dotfiles.git


sudo ansible-pull -U https://github.com/FQ211776/ansible.git
